<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 新 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css">

<!-- 可选的Bootstrap主题文件（一般不用引入） -->
<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<style>
html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;}
*{-webkit-user-select:none;-moz-user-select:none;user-select:none;-o-user-select:none;-ms-user-select:none;}
#_grib {position: absolute;right:0;height:340px;border:solid 0px #000;background-color: #eee;}

#_grib div{position:absolute;border:solid 0px #000;}
[class*="col-"] {
  padding-top: 15px;
  padding-bottom: 15px;
  background-color: #eee;
  background-color: rgba(86,61,124,.15);
  border: 0px solid #ddd;
  border: 0px solid rgba(86,61,124,.2);
}
</style>
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>



</head>

<body >
<div id="_dashboard" style="position: absolute;left:0;top:0;height:20px;width:100px;">
<span id="_score" style="color:red;">0</span>
<span id="_lost" style="color:green;">0</span>
<span id="_totel" style="color:#000;">0</span>
</div>
<!--  横屏模式
<div id="_ctrl" style="position: absolute;left:0;bottom:0;width:200px;height:500px;">
	<div id="_hummer" style="width:200px;height:250px;background:red;"></div>
	<div id="_fish" style="width:200px;height:250px;background:green;"></div>
</div>
-->

<!-- 竖屏模式 -->
<div id="_ctrl" style="position: absolute;left:0;bottom:0;width:100%;">
	<div id="_hummer" style="float:left;width:50%;height:100%;background:red;"></div>
	<div id="_fish" style="float:left;width:50%;height:100%;background:green;"></div>
</div>


<div id="_grib"></div>
	  
	  
<script>


function cat_mouse(option){
	
	var this1 = this;

	var _grib_obj = $("#"+option.id);
	var row = option.row;	//
	var cos = option.cos;
	var countBlock = row*cos;
	var ctrl = option.ctrl;
	this1.showTime = option.showTime;	//mouse or cat 出现的间隔时间（初始的）
	this1.hideTime = option.hideTime;	//mouse or cat 消失的等待时间（初始的）
	this1.catOdds = option.catOdds;	//cat 出现的概率（初始的 ,用小数表示）
	this1.showTimeV = option.showTimeV;	//mouse or cat 出现的间隔时间的增量
	this1.hideTimeV = option.hideTimeV;	//mouse or cat 消失的等待时间的增量
	this1.catOddsV = option.catOddsV;	//cat 出现的概率的增量
	this1.countM = 0;	//mouse的总数
	this1.countC = 0;	//cat的总数
	this1.score = 0;	//打到mouse的数量
	
	this1._ctrl = false; //false _fish _hummer 当前道具

	//计算网格大小
	var _win_width,_win_height;
	_win_width = $(window).width();
	_win_height = $(window).height();

	if(_win_width > _win_height){
		_grib_obj.width(_win_height);
		_grib_obj.height(_win_height);
		
	}else{
		_grib_obj.width(_win_width);
		_grib_obj.height(_win_width);
	}
	
	//resize时重置网格大小
	$(window).resize(function(){
		if($(window).width() > $(window).height()){
			_grib_obj.width($(window).height());
			_grib_obj.height($(window).height());
		}else{
			_grib_obj.width($(window).width());
			_grib_obj.height($(window).width());
		}
		this1.createBlock(row,cos);
	});
	
	//创建网格
	this1.createBlock = function (row,cos){
		//
		var _gribW = _grib_obj.width();	
		var _gribH = _grib_obj.height();

		//格子的尺寸 亦作为格子的大小
		var BlockW = _gribW/cos;
		var BlockH = _gribH/row;

		//清除所有格子
		_grib_obj.children().remove();

		//生成格子
		for(var j=0;j<row;j++){
			for(var i=0;i<cos;i++){
				
				_grib_obj.append('<div style="top:'+j*BlockH+'px;left:'+i*BlockW+'px;width:'+BlockW+'px;height:'+BlockH+'px;"></div>');
			}
		}

	}
		
	this1._mouse = function(){
		var this2 = this;
		this2._m = $('<div class="_mouse" style="width:100%;height:100%;background:red;"></div>');
		this2._m.bind('touchstart',function(){
			
			if(this1._ctrl == '_hummer'){	//当前道具为_hummer 即打中
				
				this2._m.remove();	//隐藏当前_mouse
				this2._m = false;
				
				this1.score++;	//得分加1
				$('#_score').html(this1.score);	//更新得分显示 
			}
			
		});
		
		_grib_obj.children().eq(Math.round(Math.random()*(countBlock-1))).html(this2._m);
		
		this2._hide = setTimeout(function(){
			
			if(this2._m){	//没打到 则更新hide等待时间
				this1.hideTime += this1.hideTimeV;
				this2._m.remove();
				this2._m = false;
				$('#_lost').html(parseInt($('#_lost').html())+1);
			}
			
		},this1.hideTime);
	 
	}
	
	this.hummered = function(){
		this1.score++;	//得分加1
		$('#_score').html(this1.score);	//更新得分显示 
	}
	
	
	this._cat = function(){
	
		this._c = $('<div class="_cat" style="width:100%;height:100%;background:green;"></div>');
		this._c.bind('touchstart',function(){
			
			if(this1._ctrl == '_fish'){	//当前道具为 _fish 
				
				this1.score += $('._mouse').size();	//得分加上当前mouse的数量
				$('._mouse').remove();	//消灭当前所有 mouse
				this1.catOdds += this1.catOddsV; //更新 catOdds （增加）
				
				//补偿隐藏等待时间（因为这里不能将 this2._m = false;）
				this1.hideTime -= this1.hideTimeV*$('._mouse').size(); 
				this2._c.remove();
				this2._c = false;
			}else{	//用错道具
				
				this1.catOdds -= this1.catOddsV; //更新 catOdds （减少）
				this2._c.remove();
				this2._c = false;
			}
			
		});
		_grib_obj.children().eq(Math.round(Math.random()*(countBlock-1))).html(this._c);
		var this2 = this;
		setTimeout(function(){
			if(this2._c){
				this2._c.remove();
				this2._c = false;
			}
		},this1.hideTime);
	 
	}
	
	//监听控制按钮
	this1.set_ctrl = function(){
	
		for(var i in ctrl){
			
			$('#'+ctrl[i]).bind('touchstart',function(){	//addEventListener
				this1._ctrl = $(this).attr('id');
			}).bind('touchmove',function(){	//addEventListener
				this1._ctrl = $(this).attr('id');
			}).bind('touchend',function(){	//addEventListener
				this1._ctrl = false;
			});
		}
	
	}
	
	
	//定时出现 mouse and cat
	this1._go = function(){
		var goT = setTimeout(function(){

			//随机选择出现 mouse or cat
			if(Math.random() > this1.catOdds){
				new this1._mouse();
				this1.countM++;	//统计mouse的总数
			}else{
				new this1._cat();
				this1.countC++;
			}
			
			//更新 showTime
			this1.showTime += this1.showTimeV;
			
			this1._go();
		},this1.showTime);
	}
	
	
	
	this1.init = function(){
		
		window.addEventListener('touchmove', function(e){e.preventDefault();});
		this1.createBlock(row,cos);
		this1._go();
		this1.set_ctrl();
		
	}

}

var cm = new cat_mouse({'id':'_grib','ctrl':['_fish','_hummer'],'row':6,'cos':6,'showTime':500,'hideTime':2000,'catOdds':0.1,'showTimeV':-0.1,'hideTimeV':-0.1,'catOddsV':0.001});
cm.init();


$(function(){
	
	//竖屏模式
	$('#_ctrl').height($(window).height() - $(window).width());

});


</script>









</body></html>